---
layout:     post
title:      区块链基础与应用
subtitle:   本文是对于区块链技术的学习与认识，不定时更新
date:       2018-1-20
author:     gxkyrftx
header-img: img/post-bg-unix-linux.jpg
catalog: true
tags:
    - 区块链
---
# 0.前言
比特币（BitCoin）的概念最初由中本聪在2009年提出，根据中本聪的思路设计发布的开源软件以及建构其上的P2P网络。比特币是一种P2P形式的数字货币。点对点的传输意味着一个去中心化的支付系统。
# 1.比特币的密码学原理
比特币是一种加密货币（crypto-currency),其中比特币中使用了密码学中的hash函数和签名。
## 1.1 哈希函数（cryptographic hash function）
### 1.1.1 性质

    1.collision resistance：除非使用brute-force，没有更好的方法制造碰撞
    应用于数字摘要，但是已知的哈希函数都不能通过数学方法证明其抗碰撞性，而是通过应用经验确定
    2.hiding：x——>h(x)，反推不行，除了暴力求解。
    应用：与性质1结合，作为digital commitment or digital equivalent of a sealed envelope（将结果作为哈希公布，起到了信封的功能）
    3.puzzle friendly（比特币中特有）：比特币中挖矿要求：h(block header)<=target,其中block header中的nonce是可变的，就是说，要想通过修改nonce求解出满足target的哈希值，除了一个一个的试nonce，没有更好的办法，这个性质，可以作为挖矿的工作量证明（prove of work）。

### 1.1.2 SHA-256（Secure Hash Algorithm）
比特币中的哈希函数使用了SHA-256，输出结果为256bit,详细介绍<https://blog.csdn.net/u011583927/article/details/80905740>

## 1.2 签名
1.应用了非对称加密算法（asymmetric encryption algorithm），比特币用户只需要创建一对（public key，private key），公钥相当于银行账号，私钥相当于密码。

2.用私钥签名，公钥验证合法性。

3.需要一个好的随机源（a good source of randomness）产生公私钥对。
# 2.比特币的数据结构
## 2.1 哈希指针（hash pointer）
普通c指针，指向的是一个地址，哈希指针除了指向一个地址外，还有一个哈希值。哈希指针用与无环的结构，环形会形成循环依赖。

## 2.2 区块链（block chain）
一个区块链的结构如下所示

![1](1.png)

它们之间有哈希指针连接，可以实现tamper-evident log，只需要检测most recent block的哈希指针，就可以检测出区块内容是否完整，是否被篡改。可以利用这个性质，只保存几个区块的哈希指针。

## 2.3 Merkle tree
### 2.3.1 Merkle tree简介
相比于一般的树，使用了哈希指针，一个典型的Merkle tree如下

![2](2.png)

假如一笔交易发生变动，那么它的哈希指针会发生变化，该哈希指针的上层哈希指针也会变化，以此类推，从而导致跟哈希发生变化，可以很方便的检测。

在block的结构中，block header中包含有Merkle tree的root hash，而block body中含有的是每一笔交易的内容。

### 2.3.2 Merkle tree作用
提供Merkle prove：轻节点确认交易信息是否在区块中。

比特币系统中的节点分为全节点和轻节点，全节点包含了一个区块中交易的所有信息，轻节点只有block header。

![3](3.png)

如果要验证一个交易是否在区块中（如图黄色的transaction），可以通过Merkle prove的方法。由轻节点向全节点发出Merkle prove，全节点提供与这个交易相关的哈希指针（红色的），然后轻节点验证与transaction相关的哈希指针（绿色的），拼接起来，最终可以计算到root H（），轻节点将计算得出的哈希值与本地的哈希值作比较，相等则证明交易在区块中，不等则证明不在。

以上的证明过程是prove of membership，复杂度是对数级别的。若要证明prove of nonmembership，在Merkle tree未排序的情况下，是线性的；在排好序的Merkle tree中，复杂度是对数级别。

# 3.比特币的共识协议
# 3.1 double spending attack
数字货币本质上是一串数字，假如仅仅依靠签名确定数字货币，比特币持有者可以通过简单的复制，将这串数字复制多份，然后分别花费。
# 3.2 防范措施
首先举一个例子，交易如下：

    1.用户A获得了铸币权（create coin）获得十个比特币
    2.A将10个比特币转给B五个，转给C五个
    3.B给C两个，给D三个
    4.C给E七个

![4](4.png)

比特币的每笔交易都包含有输入和输出，输入是指比特币的来源，输出是指比特币转入的账户的公钥的哈希。当B想要将五个比特币给F的时候，回溯到B比特币的来源，会发现B的五个比特币是有交易记录的，已经消费了，因此这笔交易不能完成，成功阻止了double spending attack。