---
layout:     post
title:      测试一下功能
subtitle:   搭个网站真不容易
date:       2019-9-15
author:     gxkyrftx
header-img: img/post-bg-unix-linux.jpg
catalog: true
tags:
    - 汇编语言
---

# 1 汇编语言与机器语言

人与计算机交流的语言，需要让计算机做事

人——》汇编语言——》编译器——》机器语言——》计算机



# 2 进制

逢几进几的运算，不同进制只是表示方法不同，对应同一个数字。意义相同。

# 3 存储器，CPU

存储器：存储数据，提供数据

- 外部存储器：硬盘，光盘
- 内部存储器：RAM（内存条），ROM（BIOS芯片）
- 一个存储单元存储一个字节

CPU：中央处理器

- 运算器：数据进行计算
- 控制器：控制操作步骤

CPU对存储器的读写

- 通过三根总线读写：地址总线，数据总线，控制总线
- 地址总线——》寻址能力（80386为32根）
- 数据总线——》一次数据传输量（80386为32根）
- 控制总线——》对其他器件的控制能力



# 4 寄存器

寄存器是CPU内部的组成部分，可以用来暂存指令，数据，地址

- 8086有14个寄存器，16位，一个字

  4个数据寄存器：AX,BX,CX,DX

  2个变址寄存器：SI,DI

  2个指针寄存器：SP,BP

  4个段寄存器：ES,CS,SS,DS

  1个指令指针寄存器：IP

  1个标志寄存器：Flags

- 80386有16个寄存器，32位，两个字

  4个数据寄存器：EAX,EBX,ECX,EDX

  2个变址寄存器：ESI,EDI

  2个指针寄存器：ESP,EBP

  6个段寄存器：ES,CS,SS,DS,FS,GS

  1个指令指针寄存器：EIP

  1个标志寄存器：EFlags

32位的通用寄存器通用性更强一些，数据寄存器也可以为指令寄存器

# 5 简单的汇编指令

mov ax  ,11F6H

add al , 0AH

最后ax的值为1100H

# 6 CS:IP

程序运行时，将代码段加载到内存中，然后CPU在内存中找到代码段，也就是代码的物理地址执行。

物理地址=基础地址+偏移地址

​				=段地址 x 10H + 偏移地址

修改CS：IP可以达到控制程序执行的目的，有两种方法：

- 同时修改CS:IP的内容

  jmp 段地址：偏移地址

  jmp 2AE3:3 ——》从2AE33H处读取指令

  jmp 3:0B16——》从00B46H处读取指令

- 修改IP 的内容

  jmp 寄存器

  jmp bx 含义上与 mov IP，bx 相同，因为执行前后的变化为

  | bx      | cs      | ip      |        |
  | ------- | ------- | ------- | ------ |
  | 0x0B16H | 0X2000H | 0x0003H | 执行前 |
  | 0x0B16H | 0X2000H | 0x0B16H | 执行后 |

  

# 7 debug使用

## 7.1 环境配置

winxp可以直接使用debug，其他的环境需要使用DOSBox+debug.exe。

下载安装，然后在安装目录中找到DOSBox 0.74 Option.bat，打开之后，找到autoexec选项，添加如下字段：

```
MOUNT C D:\masmpro
set PATH=$PATH$;D:\xxxxx
```

并且在d盘下创建xxxxx目录，并且放入：debug.exe,edit.com,LINK.EXE,MASM.EXE

## 7.2 常用操作

- R：查看更改CPU中，寄存器的值
- D：查看内存中的内容
- E：改写内存中的内容
- U：将内存中的机器指令翻译为汇编指令
- T：执行一条机器指令
- A:以汇编的格式在内存中写入一条指令

# 8 分段管理

物理地址是内存单元的编号。

逻辑地址是用户编程时使用的，形式为（段基址：段内偏移地址），物理地址=段基址x10H+偏移地址

8086CPU有4个段寄存器，用来确定每个逻辑段的起始位置，各个段寄存器含义如下：

- CS（代码段）：指明代码的起始地址，使用方式（CS:IP）
- SS （堆栈段）：指明堆栈段的起始地址，使用方式（SS:SP）
- DS（数据段）：指明数据的起始地址，使用方式（DS:EA）
- ES（附加段）：指明附加段的起始地址，使用方式（ES:EA）

# 9 标志寄存器

8086的标志位寄存器如下

| 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    |      |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|      |      |      |      | OF   | DF   | IF   | TF   | SF   | ZF   |      | AF   |      | PF   |      | CF   |

- 状态标志：

  用于记录运行结果的状态信息：CF,ZF,SF,PF,OF,AF

- 控制标志：

  用于控制处理器执行指令：DF,IF,TF

  | 寄存器 | 意义                                                         | 举例                                             |
  | ------ | ------------------------------------------------------------ | ------------------------------------------------ |
  | CF     | 进位标志，有进位时flag=1                                     | c2H+c7H=(1)89H,标志位为1                         |
  | ZF     | 零标志位，运算结果为0，flag=1                                | 39H+c7H=（1）00H,标志位为1                       |
  | SF     | 符号标志位，最高位为1，flag=1                                | 2CH+7CH=A8H，标志位为1                           |
  | PF     | 奇偶标志位，字节中1的个数为偶数，flag=1                      | 39H+C7H=(1)00H,标志位为1                         |
  | OF     | 溢出标志，运算有溢出，OF=1                                   | 2CH+7CH=A8H，标志位为1                           |
  | AF     | 辅助进位标志，低半字节有进位或借位，flag=1                   | 39H+78H=B1H，标志位为1                           |
  | DF     | 方向标志位，用于串操作中控制地址方向，存储器地址自动减少，flag=1 | CLD执行后DF=0;STD执行后DF=1                      |
  | IF     | 中断标志位，中断是否可以被响应，flag=1，允许中断             | CLI指令用于复位中断标志，IF=0。STL用于置位，IF=1 |
  | TF     | 陷阱标志位，控制处理器单步操作的方式。flag=1，单步执行       | 单步执行指令，可以对程序进行调试                 |

  # 10 指令

  指令一般由：操作码+操作数。构成

  根据操作数的类型不同，指令的结构可以为：操作码+目的操作数+源操作数

  # 11 寻址方式

  指令中数据的存储位置有3种

  1. 存放在指令中（立即数）
  2. 存于寄存器中（寄存器操作数）
  3. 存于存储器中（存储器寻址）

  

  寻址方式

  | 寻址方式               | 例子                        | 解释                                                         |
  | ---------------------- | --------------------------- | ------------------------------------------------------------ |
  | 立即数寻址             | mov al,80H                  | 源操作数是数据，目的操作数是寄存器                           |
  | 寄存器寻址             | mov ax,cx                   | 将寄存器中的值赋给另一个寄存器                               |
  | 直接寻址               | mov al,[1064H]              | 操作数存在内存中，操作数的偏移地址直接在指令中，默认操作数在数据段 |
  | 寄存器间接寻址         | mov ax，[si]####mov [bx],al | bx，si，di作为间接寻址寄存器，默认操作数存放于数据段，段寄存器使用DS。bp作为间接寻址寄存器，默认操作数存放于堆栈段，段寄存器使用ss |
  | 寄存器相对寻址         | mov cl,[bx+1064H]           | 相对于寄存器间接寻址多了一个偏移量                           |
  | 基址加变址寻址方式     | mov ah,[bp] [si]            | bx，bp是基址寄存器，把si和di变址寄存器，计算时，段寄存器+bp的值+si的值 |
  | 相对基址加变址寻址方式 | mov [bx+di+1234H]，ah       | 比基址加变址寻址方式多了一个偏移量                           |

  # 12 汇编指令
  
  # 12.1 数据传送指令
  
  ### 12.1.1 通用传送指令
  
  | 指令 | 格式         | 其他                                                         |
  | ---- | ------------ | ------------------------------------------------------------ |
  | mov  | mov dst,src  | 1.存储器操作数之间不能直接传送：mov [1000H],[di]错误，应使用通用寄存器 |
  |      |              | 2.立即数不能直接送段寄存器： mov ds,1000H                    |
  |      |              | 3.段寄存器之间不能直接传递: mov es,ds                        |
  |      |              | 4.cs只可以作为源操作数: mov cs ,ax                           |
  |      |              | 5.源操作数和目的操作数位数需要相同                           |
  | push | push  src    | sp-2（因为按一个字两个字节为单位操作）,然后按“高高低低原则”放入数据 |
  | pop  | pop  dst     | 现弹出数据，然后sp-2                                         |
  | xchg | xchg dst,src |                                                              |
  
  
  
  ### 12.1.2 累加器专用传送指令
  
  | 指令                                                         | 格式           | 说明                                       |
  | ------------------------------------------------------------ | -------------- | ------------------------------------------ |
  | IN (用于CPU从外设端口中接收数据)                             | IN AL,data8    | 8位端口输入一字节                          |
  |                                                              | IN AX,data8    | 8位端口输入一字                            |
  |                                                              | IN AL,DX       | 16位端口输入一字节                         |
  |                                                              | IN AX,DX       | 16位端口输入一字                           |
  | OUT (用于CPU向外设端口中发送数据)                            | OUT data8,AL   | 给8位端口输出一个字节                      |
  |                                                              | OUT data8,AX   | 给8位端口输出一个字                        |
  |                                                              | OUT DX,AL      | 给16位端口输出一个字节                     |
  |                                                              | OUT DX,AX      | 给16位端口输出一个字                       |
  | LEA（将源操作数的偏移地址传送到目的操作数）                  | LEA reg16,mem  | 目的操作数必须是16位的寄存器，             |
  | LDS（将源操作数指定的4个相继字节的数据分别送指令到指定的寄存器及DS寄存器） | LES reg16 ,mem | 先给寄存器赋值，然后，从内存中读取两个字节 |
  
  
  
  ### 12.1.3 地址传送指令
  
  | 指令                                                         | 格式           | 说明                                       |
  | ------------------------------------------------------------ | -------------- | ------------------------------------------ |
  | LEA（将源操作数的偏移地址传送到目的操作数）                  | LEA reg16,mem  | 目的操作数必须是16位的寄存器，             |
  | LDS（将源操作数指定的4个相继字节的数据分别送指令到指定的寄存器及DS寄存器） | LES reg16 ,mem | 先给寄存器赋值，然后，从内存中读取两个字节 |
  
  
  
  ### 12.1.4 标志传送指令
  
  | 指令                               | 格式  | 说明                            |
  | ---------------------------------- | ----- | ------------------------------- |
  | LAHF（标志寄存器的低八位赋值给AH） | LAHF  | psw的低字节——》AH               |
  | SAHF（AH的值赋值给标志寄存器）     | SAHF  | AH——》psw的低字节               |
  | PUSHF                              | PUSHF | （SP）《——（SP）-2              |
  |                                    |       | （（SP）+1，（SP））《——（PSW） |
  | POPF                               | POPF  | （PSW）《——（（SP）+1，（SP）） |
  |                                    |       | （SP）《——（SP）+2              |
  
  
  
  
  
  
  
  
  
  